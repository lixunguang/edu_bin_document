import{b as r,g as Z,_ as ee}from"./index.f3b0bd2a.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css                *//* empty css               *//* empty css              *//* empty css              */import{d as te,e as _,aW as ae,bm as ne,bc as oe,bi as le,b2 as se,C as ue,aI as a,aG as l,aH as ie,a$ as S,B as re,F as h,aM as d,u as L,bh as de,be as ce,bj as me,b9 as pe,ba as fe}from"./arco.be854816.js";import{E as H}from"./Editor.01008c40.js";import{h as _e}from"./vue.0bc632a1.js";import"./chart.cc2aed62.js";const ve=C=>(pe("data-v-05106ede"),C=C(),fe(),C),ge={class:"container"},he=ve(()=>h("p",null,"\u7AE0\u8282\u8BE6\u60C5",-1)),be={style:{marginLeft:"40px",marginRight:"40px"}},we={style:{marginLeft:"80px"}},ke={style:{marginLeft:"80px"}},Ce={style:{marginLeft:"80px"}},ye={style:{marginLeft:"80px"}},Ie={style:{marginLeft:"80px"}},Ee=["innerHTML"],Fe=te({__name:"chapterDetailEdit",setup(C){const i=_e(),D={pageSize:10},z=[{title:"ID",dataIndex:"id"},{title:"\u540D\u79F0",dataIndex:"title"},{title:"\u5185\u5BB9",dataIndex:"content",ellipsis:!0,tooltip:!0},{title:"\u63CF\u8FF0",dataIndex:"desc"},{title:"\u4FEE\u6539",slotName:"edit",width:80},{title:"\u5220\u9664",slotName:"delete",width:80}],s=_({id:0,title:"",desc:"",content:""}),f=_([]),b=_(!1),N=_(!1),R=()=>{b.value=!0,N.value=!0},O=(n,e,o,t)=>{b.value=!0,N.value=!1,s.value.id=n,s.value.title=e,s.value.content=o,s.value.desc=t},j=async function(n){for(let o=0;o<f.value.length;o+=1)f.value[o].id===n&&f.value.splice(o,1);const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(n)};await r.post("admin/lesson/content/del",e)},T=async function(){if(N.value){const n={title:s.value.title,desc:s.value.desc,content:s.value.content},o=(await r.post("/admin/richtext/add",n)).data.id,t={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(o),resource_index:0};await r.post("/admin/lesson/content/add",t),f.value.push({id:o,title:s.value.title,desc:s.value.desc,content:s.value.content})}else{for(let e=0;e<f.value.length;e+=1)f.value[e].id===s.value.id&&(f.value[e].title=s.value.title,f.value[e].content=s.value.content,f.value[e].desc=s.value.desc);const n={id:Number(s.value.id),title:String(s.value.title),desc:String(s.value.desc),content:String(s.value.content)};await r.post("/admin/richtext/update",n)}},U=()=>{b.value=!1},x=_(!1),k=_("");_(!1);const $=()=>{x.value=!0},P=async function(){const n={content:k.value,title:"",desc:""},e=await r.post("/admin/richtext/add",n);debugger;const o=e.data.id,t={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(o)};await r.post("/admin/lesson/work/requirement/update",t)},G=()=>{b.value=!1};(async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await r.post("/admin/lesson/content",e);for(let t=0;t<((n=o.data)==null?void 0:n.length);t+=1)f.value.push({id:o.data[t].resource_id,title:o.data[t].title,desc:o.data[t].desc,content:o.data[t].content})}catch(e){throw console.log(e),e}})();const y=_([]),I=_([]),E=_([]),J=async function(n,e){try{const o=n.data[0].id,t={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(o),resource_index:Number(0)};if(e===1){y.value.push({uid:n.data[0].id,name:n.data[0].url,url:n.data[0].full_url});const c=await r.post("/admin/lesson/refer/add",t)}if(e===2){I.value.push({uid:n.data[0].id,name:n.data[0].url,url:n.data[0].full_url});const c=await r.post("admin/lesson/experiment/add",t)}if(e===3){E.value.push({uid:n.data[0].id,name:n.data[0].url,url:n.data[0].full_url});const c=await r.post("admin/lesson/work/add",t)}}catch(o){throw console.log(o),o}},B=function(n,e){var o;for(let t=0;t<((o=n.value)==null?void 0:o.length);t+=1)if(n.value[t].uid===e)return n.value.splice(t,1),!0;return!1},W=async function(n){try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(n)};if(B(y,n)){const o=await r.post("/admin/lesson/refer/del",e)}if(B(I,n)){const o=await r.post("/admin/lesson/experiment/del",e)}if(B(E,n)){const o=await r.post("/admin/lesson/work/del",e)}}catch(e){throw console.log(e),e}};(async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await r.post("admin/lesson/refer",e);for(let t=0;t<((n=o.data)==null?void 0:n.length);t+=1)y.value.push({uid:o.data[t].resource_id,name:o.data[t].title,url:o.data[t].content})}catch(e){throw console.log(e),e}})(),async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await r.post("admin/lesson/experiment",e);for(let t=0;t<((n=o.data)==null?void 0:n.length);t+=1)I.value.push({uid:o.data[t].resource_id,name:o.data[t].title,url:o.data[t].content})}catch(e){throw console.log(e),e}}(),async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await r.post("admin/lesson/work",e);for(let c=0;c<((n=o.data)==null?void 0:n.length);c+=1)E.value.push({uid:o.data[c].resource_id,name:o.data[c].title,url:o.data[c].content});const t=await r.post("/admin/lesson/work/requirement",e);k.value=t.data.content}catch(e){throw console.log(e),e}}();let F=1;const X=n=>{F=1},K=n=>{F=2},Q=n=>{F=3},q=n=>{const{onProgress:e,onError:o,onSuccess:t,fileItem:c,name:m}=n,p=new XMLHttpRequest;p.upload&&(p.upload.onprogress=function(g){let v;g.total>0&&(v=g.loaded/g.total),e(v,g)}),p.onerror=function(v){o(v)},p.onload=function(){if(p.status<200||p.status>=300)return o(p.responseText);const v=JSON.parse(p.responseText);return J(v,F),t(p.response)};const w=new FormData,M=String(Z());return w.append(m||"file",c.file),p.open("post","/admin/upload_files",!0),p.setRequestHeader("Authorization",M),p.send(w),{abort(){p.abort()}}},A=n=>{const{uid:e}=n;return W(e),new Promise((o,t)=>{S.confirm({title:"on-before-remove",content:`\u786E\u8BA4\u5220\u9664 ${n.name}`,onOk:()=>o(!0)})})};return(n,e)=>{const o=ie("Breadcrumb"),t=de,c=ae,m=ce,p=ne,w=oe,M=me,g=le,v=se,V=S;return re(),ue("div",ge,[a(o,{items:["menu.mSimu","menu.mSimu.chapterDetailEdit"]},null,8,["items"]),a(g,null,{default:l(()=>[a(M,null,{default:l(()=>[he,h("div",be,[a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[d(" \u6559\u5B66\u5185\u5BB9: ")]),_:1}),a(t,null,{default:l(()=>[h("div",we,[a(m,null,{default:l(()=>[a(t,{span:2},{default:l(()=>[a(c,{type:"primary",onClick:e[0]||(e[0]=u=>R())},{default:l(()=>[d(" \u589E\u52A0 ")]),_:1})]),_:1})]),_:1}),a(p,{columns:z,data:f.value,pagination:D},{edit:l(({record:u})=>[a(c,{onClick:Y=>O(u.id,u.title,u.content,u.desc)},{default:l(()=>[d("\u4FEE\u6539")]),_:2},1032,["onClick"])]),delete:l(({record:u})=>[a(c,{onClick:Y=>n.$modal.info({title:"\u5220\u9664",content:u.id,onOk:()=>j(u.id)})},{default:l(()=>[d("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1},8,["data"])])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[d(" \u6559\u5B66\u53C2\u8003\u8D44\u6E90: ")]),_:1}),a(t,null,{default:l(()=>[h("div",ke,[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[a(w,{"custom-request":q,"file-list":y.value,onBeforeRemove:A,onChange:X},null,8,["file-list"])]),_:1})]),_:1})])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[d(" \u505A\u5B9E\u9A8C: ")]),_:1}),a(t,null,{default:l(()=>[h("div",Ce,[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[a(w,{"custom-request":q,"file-list":I.value,onBeforeRemove:A,onChange:K},null,8,["file-list"])]),_:1})]),_:1})])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[d(" \u5E03\u7F6E\u4F5C\u4E1A: ")]),_:1}),a(t,null,{default:l(()=>[h("div",ye,[a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[d(" \u4F5C\u4E1A\u8981\u6C42 ")]),_:1}),a(t,{span:4},{default:l(()=>[a(w,{"custom-request":q,"file-list":E.value,onBeforeRemove:A,onChange:Q},null,8,["file-list"])]),_:1})]),_:1})])]),_:1}),a(t,null,{default:l(()=>[h("div",Ie,[a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[d(" \u4F5C\u4E1A\u8BF4\u660E ")]),_:1}),a(t,{span:4},{default:l(()=>[a(c,{type:"primary",onClick:e[1]||(e[1]=u=>$())},{default:l(()=>[d(" \u7F16\u8F91\u4F5C\u4E1A\u8BF4\u660E ")]),_:1})]),_:1}),a(t,null,{default:l(()=>[h("p",{innerHTML:k.value},null,8,Ee)]),_:1})]),_:1})])]),_:1})]),_:1})])]),_:1})]),_:1}),a(V,{visible:b.value,"onUpdate:visible":e[5]||(e[5]=u=>b.value=u),width:"auto",onOk:T,onCancel:U},{title:l(()=>[d(" \u65B0\u589E/\u7F16\u8F91\u6559\u5B66\u5185\u5BB9 ")]),default:l(()=>[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[d("\u6807\u9898\uFF1A")]),_:1}),a(t,{span:4},{default:l(()=>[a(v,{modelValue:s.value.title,"onUpdate:modelValue":e[2]||(e[2]=u=>s.value.title=u),style:{width:"320px"},"allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[d("\u63CF\u8FF0\uFF1A")]),_:1}),a(t,{span:4},{default:l(()=>[a(v,{modelValue:s.value.desc,"onUpdate:modelValue":e[3]||(e[3]=u=>s.value.desc=u),style:{width:"320px"},"allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[d("\u5185\u5BB9\uFF1A")]),_:1}),a(t,null,{default:l(()=>[a(L(H),{modelValue:s.value.content,"onUpdate:modelValue":e[4]||(e[4]=u=>s.value.content=u),"api-key":"p33s220d86w6vicquiqrth23ziuycnagjsyzfsa18stpjzpt",init:{plugins:"preview searchreplace autolink autosave code visualblocks visualchars fullscreen image link media codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount quickbars emoticons importcss",toolbar:"undo redo | removeformat forecolor backcolor | bold italic underline | fontfamily fontsize blocks | alignleft aligncenter alignright alignjustify | outdent indent | numlist bullist | quickimage link"},"initial-value":"Once upon a time..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["visible"]),a(V,{visible:x.value,"onUpdate:visible":e[7]||(e[7]=u=>x.value=u),width:"auto",onOk:P,onCancel:G},{title:l(()=>[d(" \u65B0\u589E/\u7F16\u8F91\u4F5C\u4E1A\u8BF4\u660E ")]),default:l(()=>[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[d("\u5185\u5BB9\uFF1A")]),_:1}),a(t,null,{default:l(()=>[a(L(H),{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=u=>k.value=u),"api-key":"p33s220d86w6vicquiqrth23ziuycnagjsyzfsa18stpjzpt",init:{plugins:"preview searchreplace autolink autosave code visualblocks visualchars fullscreen image link media codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount quickbars emoticons importcss",toolbar:"undo redo | removeformat forecolor backcolor | bold italic underline | fontfamily fontsize blocks | alignleft aligncenter alignright alignjustify | outdent indent | numlist bullist | quickimage link"},"initial-value":"Once upon a time..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["visible"])])}}});const Ge=ee(Fe,[["__scopeId","data-v-05106ede"]]);export{Ge as default};
