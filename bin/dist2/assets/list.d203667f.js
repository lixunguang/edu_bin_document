import{a as G,b as f,g as W,_ as X}from"./index.f3b0bd2a.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css               */import{d as Q,e as v,aH as Y,B as x,C as V,F as k,aI as u,aG as o,aM as m,aK as Z,aJ as ee,aD as te,aN as ae,a$ as S,aW as oe,bh as le,be as ue,bm as ne,b2 as se,b3 as ie,bK as re,bL as de,bM as ce,bc as pe,b8 as me,b9 as _e,ba as fe}from"./arco.be854816.js";import{f as ve,h as ge}from"./vue.0bc632a1.js";import"./chart.cc2aed62.js";const he=h=>(_e("data-v-a7ae4a63"),h=h(),fe(),h),ye={class:"container"},Ce={class:"list"},be=he(()=>k("h3",null,"\u5B66\u4E60\u8BFE\u7A0B\u5217\u8868",-1)),we=Q({__name:"list",setup(h){const E=ve();ge();const N=G(),{login_id:A}=N,q=a=>{E.push({name:a})},M=(a,e)=>{E.push({name:a,params:{id:e}})},R={pageSize:10},$=[{title:"ID",dataIndex:"id",width:100},{title:"\u9898\u76EE",dataIndex:"title",width:200},{title:"\u63CF\u8FF0",dataIndex:"desc"},{title:"\u4F5C\u8005",dataIndex:"author",width:100},{title:"\u5C01\u9762\u56FE",dataIndex:"picture_url",width:100},{title:"\u7C7B\u522B",dataIndex:"category",width:100},{title:"\u9884\u89C8",slotName:"check"},{title:"\u7F16\u8F91",slotName:"edit"},{title:"\u89C6\u9891",slotName:"editVideo"},{title:"\u5220\u9664",slotName:"delete"}],b=v([{id:1,title:"",desc:"",author:"",category:"",picture_url:""}]),w=async function(){try{const e=(await f.post("/admin/learning/all")).data;if(e.length){b.value=[];for(let t=0;t<e.length;t+=1)b.value.push({id:e[t].id,title:e[t].title,desc:e[t].desc,author:e[t].author,category:e[t].category,picture_url:e[t].picture_url})}}catch(a){throw console.log(a),a}};w();const y=v([{id:1,title:"",desc:""}]);(async function(){try{const e=(await f.post("/admin/learning/category/all")).data;if(e.length){y.value=[];for(let t=0;t<e.length;t+=1)y.value.push({id:e[t].id,title:e[t].title,desc:e[t].desc})}}catch(a){throw console.log(a),a}})();const p=v([]),D=a=>{const{onProgress:e,onError:t,onSuccess:s,fileItem:r,name:B}=a,i=new XMLHttpRequest;i.upload&&(i.upload.onprogress=function(c){let d;c.total>0&&(d=c.loaded/c.total),e(d,c)}),i.onerror=function(d){t(d)},i.onload=function(){if(i.status<200||i.status>=300)return t(i.responseText);const d=JSON.parse(i.responseText);return p.value.push({uid:d.data[0].id,name:d.data[0].url,url:d.data[0].full_url}),s(i.response)};const C=new FormData,_=String(W());return C.append(B||"file",r.file),i.open("post","/admin/upload_files",!0),i.setRequestHeader("Authorization",_),i.send(C),{abort(){i.abort()}}},O=a=>{const{uid:e}=a,t=p.value;for(let s=0;s<t.length;s+=1)t[s].uid===e&&t.splice(s,1);return new Promise((s,r)=>{S.confirm({title:"on-before-remove",content:`\u786E\u8BA4\u5220\u9664 ${a.name}`,onOk:()=>s(!0)})})},g=v(!1),F=v(!1),n=v({id:0,title:"",desc:"",author:"",category:""}),T=()=>{g.value=!0,F.value=!0,n.value.id=0,n.value.title="",n.value.desc="",n.value.author="",n.value.category="",p.value=[]},U=async function(a){g.value=!0,F.value=!1;const e={id:a},t=await f.post("/admin/learning",e);n.value={id:t.data.id,title:t.data.title,desc:t.data.desc,author:t.data.author,category:t.data.category},p.value=[{uid:t.data.picture_id,name:t.data.picture_name,url:t.data.picture_url}]},P=async function(){const a=String(A),e=n.value.category;let t=0;const s=y.value;for(let r=0;r<s.length;r+=1)e===s[r].title&&(t=s[r].id);if(F.value){const r={title:n.value.title,desc:n.value.desc,author:a,category_id:t,cover_picture_id:p.value[0].uid};await f.post("/admin/learning/add",r)}else{const r={id:n.value.id,title:n.value.title,desc:n.value.desc,author:a,category_id:t,picture_url:p.value[0].uid};await f.post("/admin/learning/update",r)}w()},L=()=>{g.value=!1},H=async function(a){const e={id:a};await f.post("/admin/learning/del",e),w()};return(a,e)=>{const t=Y("Breadcrumb"),s=oe,r=le,B=ue,i=ne,C=se,_=ie,c=re,d=de,z=ce,J=pe,K=me,j=S;return x(),V("div",ye,[k("div",null,[u(t,{items:["menu.mStudy","menu.mStudy.list"]},null,8,["items"])]),k("div",Ce,[be,u(B,null,{default:o(()=>[u(r,{span:2},{default:o(()=>[u(s,{type:"primary",onClick:e[0]||(e[0]=l=>T())},{default:o(()=>[m(" \u65B0\u589E\u5B66\u4E60\u8BFE\u7A0B ")]),_:1})]),_:1})]),_:1}),u(i,{columns:$,data:b.value,pagination:R},{check:o(({})=>[u(s,{onClick:e[1]||(e[1]=l=>q("NoticePre"))},{default:o(()=>[m("\u9884\u89C8")]),_:1})]),edit:o(({record:l})=>[u(s,{onClick:I=>U(l.id)},{default:o(()=>[m("\u7F16\u8F91\u57FA\u672C\u4FE1\u606F")]),_:2},1032,["onClick"])]),editVideo:o(({record:l})=>[u(s,{onClick:I=>M("VideoEdit",l.id)},{default:o(()=>[m("\u7F16\u8F91\u89C6\u9891")]),_:2},1032,["onClick"])]),delete:o(({record:l})=>[u(s,{onClick:I=>a.$modal.info({title:"\u5220\u9664",content:l.id,onOk:()=>H(l.id)})},{default:o(()=>[m("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1},8,["data"])]),u(j,{visible:g.value,"onUpdate:visible":e[5]||(e[5]=l=>g.value=l),width:"800px",onOk:P,onCancel:L},{title:o(()=>[m(" \u65B0\u589E/\u7F16\u8F91\u5B66\u4E60\u8BFE\u7A0B ")]),default:o(()=>[u(K,{model:n.value,"auto-label-width":""},{default:o(()=>[u(_,{field:"title",label:"\u9898\u76EE"},{default:o(()=>[u(C,{modelValue:n.value.title,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.title=l),style:{width:"320px"}},null,8,["modelValue"])]),_:1}),u(_,{field:"title",label:"\u63CF\u8FF0"},{default:o(()=>[u(c,{modelValue:n.value.desc,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.desc=l),style:{width:"600px"},placeholder:"Please enter something","allow-clear":""},null,8,["modelValue"])]),_:1}),u(_,{field:"title",label:"\u7C7B\u522B"},{default:o(()=>[u(z,{modelValue:n.value.category,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.category=l),style:{width:"320px"},placeholder:"Please select ..."},{default:o(()=>[(x(!0),V(Z,null,ee(y.value,l=>(x(),te(d,{key:l.id,value:l.title},{default:o(()=>[m(ae(l.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(_,{field:"title",label:"\u5C01\u9762\u56FE"},{default:o(()=>[u(r,{span:8},{default:o(()=>[u(J,{"custom-request":D,"file-list":p.value,limit:1,onBeforeRemove:O},null,8,["file-list"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}});const Te=X(we,[["__scopeId","data-v-a7ae4a63"]]);export{Te as default};
