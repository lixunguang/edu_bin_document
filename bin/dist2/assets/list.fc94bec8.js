import{a as Y,b as _,g as K,_ as Q}from"./index.f3b0bd2a.js";/* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css              */import{d as Z,e as f,aH as tt,B as D,C as et,F as v,aI as o,aG as n,aM as r,u as at,aD as nt,aE as ot,a$ as M,aW as lt,bh as ut,be as it,bm as st,b2 as rt,bc as dt,b9 as ct,ba as pt}from"./arco.be854816.js";import{E as mt}from"./Editor.01008c40.js";import{f as ft,h as _t}from"./vue.0bc632a1.js";import"./chart.cc2aed62.js";const R=w=>(ct("data-v-ff2519fc"),w=w(),pt(),w),vt={class:"container"},ht=R(()=>v("p",null,"banner\u65B0\u95FB",-1)),gt=R(()=>v("p",null,"\u6807\u9898\u65B0\u95FB",-1)),bt={style:{marginLeft:"80px"}},wt=Z({__name:"list",setup(w){const O=ft(),N=_t(),z=Y(),{login_id:A}=z,x=(e,t)=>{O.push({name:e,params:{id:t}})},$={pageSize:10},T=[{title:"id",dataIndex:"id"},{title:"\u9898\u76EE",dataIndex:"title"},{title:"\u65F6\u95F4",dataIndex:"date"},{title:"\u4F5C\u8005",dataIndex:"author"},{title:"banner\u56FE",dataIndex:"pic_url"},{title:"\u9884\u89C8",slotName:"pre",width:80},{title:"\u4FEE\u6539",slotName:"edit",width:80},{title:"\u5220\u9664",slotName:"delete",width:80}],B=f([{id:1,title:"",date:"",author:"",pic_url:""}]),P=[{title:"id",dataIndex:"id"},{title:"\u9898\u76EE",dataIndex:"title"},{title:"\u65F6\u95F4",dataIndex:"date"},{title:"\u4F5C\u8005",dataIndex:"author"},{title:"\u9884\u89C8",slotName:"pre",width:80},{title:"\u4FEE\u6539",slotName:"edit",width:80},{title:"\u5220\u9664",slotName:"delete",width:80}],F=f([{id:1,title:"banner\u65B0\u95FB1",date:"20230721",author:"\u674E\u5148\u751F"}]),C=async function(){try{const t=(await _.post("/admin/news/banner/all")).data;if(t.length){B.value=[];for(let a=0;a<t.length;a+=1)B.value.push({id:t[a].news_id,title:t[a].title,date:t[a].date,author:t[a].author,pic_url:t[a].pic_url})}}catch(e){throw console.log(e),e}};C();const y=async function(){try{const t=(await _.post("/admin/news/all")).data;if(t.length){F.value=[];for(let a=0;a<t.length;a+=1)F.value.push({id:t[a].news_id,title:t[a].title,date:t[a].date,author:t[a].author})}}catch(e){throw console.log(e),e}};y();const c=f([]),U=async function(e){try{c.value.push({uid:e.data[0].id,name:e.data[0].url,url:e.data[0].full_url})}catch(t){throw console.log(t),t}},j=function(e,t){var a;for(let u=0;u<((a=e.value)==null?void 0:a.length);u+=1)if(e.value[u].uid===t)return e.value.splice(u,1),!0;return!1},L=async function(e){try{const t={course_id:Number(N.params.courseId),lesson_id:Number(N.params.chapterId),resource_id:Number(e)};j(c,e)}catch(t){throw console.log(t),t}},H=e=>{const{onProgress:t,onError:a,onSuccess:u,fileItem:d,name:p}=e,i=new XMLHttpRequest;i.upload&&(i.upload.onprogress=function(m){let l;m.total>0&&(l=m.loaded/m.total),t(l,m)}),i.onerror=function(l){a(l)},i.onload=function(){if(i.status<200||i.status>=300)return a(i.responseText);const l=JSON.parse(i.responseText);return U(l),u(i.response)};const k=new FormData,I=String(K());return k.append(p||"file",d.file),i.open("post","/admin/upload_files",!0),i.setRequestHeader("Authorization",I),i.send(k),{abort(){i.abort()}}},G=e=>{const{uid:t}=e;return L(t),new Promise((a,u)=>{M.confirm({title:"on-before-remove",content:`\u786E\u8BA4\u5220\u9664 ${e.name}`,onOk:()=>a(!0)})})},h=f(!1),E=f(!1),g=f(!1),s=f({id:0,title:"\u65B0\u95FB\u6807\u9898...",content:"\u5185\u5BB9...1"}),q=e=>{h.value=!0,E.value=!0,s.value.id=0,s.value.title="",s.value.content="",c.value=[],g.value=e},S=async function(e,t){h.value=!0,E.value=!1;const a={id:e},u=await _.post("/admin/news",a);s.value.id=e,s.value.title=u.data.title,s.value.content=u.data.content,c.value=[],c.value.push({uid:u.data.picture_id,name:u.data.pictrue_title,url:u.data.picture_url}),g.value=t},J=()=>{const e=new Date,t=e.getFullYear(),a=e.getMonth()+1,u=e.getDate();return`${t}-${a<10?`0${a}`:a}-${u<10?`0${u}`:u} ${e.toTimeString().substr(0,8)}`},W=async function(){const e=J(),t=String(A);if(E.value){const a={title:s.value.title,date:e,content:s.value.content,author:t,picture_id:c.value.length?Number(c.value[0].uid):0};g.value||(a.picture_id=0),await _.post("/admin/news/add",a)}else{const a={id:s.value.id,title:s.value.title,date:e,content:s.value.content,author:t,picture_id:c.value.length?Number(c.value[0].uid):0};g.value||(a.picture_id=0),await _.post("/admin/news/update",a)}C(),y()},X=()=>{h.value=!1},V=async function(e){const t={id:e};await _.post("/admin/news/del",t),C(),y()};return(e,t)=>{const a=tt("Breadcrumb"),u=lt,d=ut,p=it,i=st,k=rt,I=dt,m=M;return D(),et("div",vt,[v("div",null,[o(a,{items:["menu.mNotice","menu.mNotice.list"]},null,8,["items"])]),v("div",null,[ht,o(p,null,{default:n(()=>[o(d,{span:2},{default:n(()=>[o(u,{type:"primary",onClick:t[0]||(t[0]=l=>q(!0))},{default:n(()=>[r(" \u65B0\u589Ebanner\u65B0\u95FB ")]),_:1})]),_:1})]),_:1}),o(i,{columns:T,data:B.value,pagination:$},{pre:n(({record:l})=>[o(u,{onClick:b=>x("NoticePre",l.id)},{default:n(()=>[r("\u9884\u89C8")]),_:2},1032,["onClick"])]),edit:n(({record:l})=>[o(u,{onClick:b=>S(l.id,!0)},{default:n(()=>[r("\u4FEE\u6539")]),_:2},1032,["onClick"])]),delete:n(({record:l})=>[o(u,{onClick:b=>e.$modal.info({title:"\u5220\u9664",content:l.id,onOk:()=>V(l.id)})},{default:n(()=>[r("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1},8,["data"])]),v("div",null,[gt,o(p,null,{default:n(()=>[o(d,{span:2},{default:n(()=>[o(u,{type:"primary",onClick:t[1]||(t[1]=l=>q(!1))},{default:n(()=>[r(" \u65B0\u589E\u6807\u9898\u65B0\u95FB ")]),_:1})]),_:1})]),_:1}),o(i,{columns:P,data:F.value,pagination:$},{pre:n(({record:l})=>[o(u,{onClick:b=>x("NoticePre",l.id)},{default:n(()=>[r("\u9884\u89C8")]),_:2},1032,["onClick"])]),edit:n(({record:l})=>[o(u,{onClick:b=>S(l.id,!1)},{default:n(()=>[r("\u4FEE\u6539")]),_:2},1032,["onClick"])]),delete:n(({record:l})=>[o(u,{onClick:b=>e.$modal.info({title:"\u5220\u9664",content:l.id,onOk:()=>V(l.id)})},{default:n(()=>[r("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1},8,["data"])]),o(m,{visible:h.value,"onUpdate:visible":t[4]||(t[4]=l=>h.value=l),width:"auto",onOk:W,onCancel:X},{title:n(()=>[r(" \u65B0\u589E/\u7F16\u8F91\u65B0\u95FB ")]),default:n(()=>[o(p,null,{default:n(()=>[o(d,{span:4},{default:n(()=>[r("\u6807\u9898\uFF1A")]),_:1}),o(d,{span:4},{default:n(()=>[o(k,{modelValue:s.value.title,"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.title=l),style:{width:"320px"},placeholder:"Please enter something","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),o(p,null,{default:n(()=>[o(d,{span:4},{default:n(()=>[r("\u5185\u5BB9\uFF1A")]),_:1}),o(d,null,{default:n(()=>[o(at(mt),{modelValue:s.value.content,"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.content=l),"api-key":"p33s220d86w6vicquiqrth23ziuycnagjsyzfsa18stpjzpt",init:{plugins:"preview searchreplace autolink autosave code visualblocks visualchars fullscreen image link media codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount quickbars emoticons importcss",toolbar:"undo redo | removeformat forecolor backcolor | bold italic underline | fontfamily fontsize blocks | alignleft aligncenter alignright alignjustify | outdent indent | numlist bullist | quickimage link"},"initial-value":"Once upon a time..."},null,8,["modelValue"])]),_:1})]),_:1}),g.value?(D(),nt(p,{key:0},{default:n(()=>[o(d,null,{default:n(()=>[r(" banner\u56FE: ")]),_:1}),o(d,null,{default:n(()=>[v("div",bt,[o(p,null,{default:n(()=>[o(d,{span:8},{default:n(()=>[o(I,{"custom-request":H,"file-list":c.value,limit:1,onBeforeRemove:G},null,8,["file-list"])]),_:1})]),_:1})])]),_:1})]),_:1})):ot("",!0)]),_:1},8,["visible"])])}}});const Mt=Q(wt,[["__scopeId","data-v-ff2519fc"]]);export{Mt as default};
